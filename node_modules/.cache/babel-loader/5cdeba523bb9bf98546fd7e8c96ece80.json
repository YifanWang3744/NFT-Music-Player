{"ast":null,"code":"\"use strict\";\n\nimport { getAddress, getContractAddress } from \"@ethersproject/address\";\nimport { BigNumber } from \"@ethersproject/bignumber\";\nimport { hexDataLength, hexDataSlice, hexValue, hexZeroPad, isHexString } from \"@ethersproject/bytes\";\nimport { AddressZero } from \"@ethersproject/constants\";\nimport { shallowCopy } from \"@ethersproject/properties\";\nimport { accessListify, parse as parseTransaction } from \"@ethersproject/transactions\";\nimport { Logger } from \"@ethersproject/logger\";\nimport { version } from \"./_version\";\nconst logger = new Logger(version);\nexport class Formatter {\n  constructor() {\n    logger.checkNew(new.target, Formatter);\n    this.formats = this.getDefaultFormats();\n  }\n\n  getDefaultFormats() {\n    const formats = {};\n    const address = this.address.bind(this);\n    const bigNumber = this.bigNumber.bind(this);\n    const blockTag = this.blockTag.bind(this);\n    const data = this.data.bind(this);\n    const hash = this.hash.bind(this);\n    const hex = this.hex.bind(this);\n    const number = this.number.bind(this);\n    const type = this.type.bind(this);\n\n    const strictData = v => {\n      return this.data(v, true);\n    };\n\n    formats.transaction = {\n      hash: hash,\n      type: type,\n      accessList: Formatter.allowNull(this.accessList.bind(this), null),\n      blockHash: Formatter.allowNull(hash, null),\n      blockNumber: Formatter.allowNull(number, null),\n      transactionIndex: Formatter.allowNull(number, null),\n      confirmations: Formatter.allowNull(number, null),\n      from: address,\n      // either (gasPrice) or (maxPriorityFeePerGas + maxFeePerGas)\n      // must be set\n      gasPrice: Formatter.allowNull(bigNumber),\n      maxPriorityFeePerGas: Formatter.allowNull(bigNumber),\n      maxFeePerGas: Formatter.allowNull(bigNumber),\n      gasLimit: bigNumber,\n      to: Formatter.allowNull(address, null),\n      value: bigNumber,\n      nonce: number,\n      data: data,\n      r: Formatter.allowNull(this.uint256),\n      s: Formatter.allowNull(this.uint256),\n      v: Formatter.allowNull(number),\n      creates: Formatter.allowNull(address, null),\n      raw: Formatter.allowNull(data)\n    };\n    formats.transactionRequest = {\n      from: Formatter.allowNull(address),\n      nonce: Formatter.allowNull(number),\n      gasLimit: Formatter.allowNull(bigNumber),\n      gasPrice: Formatter.allowNull(bigNumber),\n      maxPriorityFeePerGas: Formatter.allowNull(bigNumber),\n      maxFeePerGas: Formatter.allowNull(bigNumber),\n      to: Formatter.allowNull(address),\n      value: Formatter.allowNull(bigNumber),\n      data: Formatter.allowNull(strictData),\n      type: Formatter.allowNull(number),\n      accessList: Formatter.allowNull(this.accessList.bind(this), null)\n    };\n    formats.receiptLog = {\n      transactionIndex: number,\n      blockNumber: number,\n      transactionHash: hash,\n      address: address,\n      topics: Formatter.arrayOf(hash),\n      data: data,\n      logIndex: number,\n      blockHash: hash\n    };\n    formats.receipt = {\n      to: Formatter.allowNull(this.address, null),\n      from: Formatter.allowNull(this.address, null),\n      contractAddress: Formatter.allowNull(address, null),\n      transactionIndex: number,\n      // should be allowNull(hash), but broken-EIP-658 support is handled in receipt\n      root: Formatter.allowNull(hex),\n      gasUsed: bigNumber,\n      logsBloom: Formatter.allowNull(data),\n      blockHash: hash,\n      transactionHash: hash,\n      logs: Formatter.arrayOf(this.receiptLog.bind(this)),\n      blockNumber: number,\n      confirmations: Formatter.allowNull(number, null),\n      cumulativeGasUsed: bigNumber,\n      effectiveGasPrice: Formatter.allowNull(bigNumber),\n      status: Formatter.allowNull(number),\n      type: type\n    };\n    formats.block = {\n      hash: hash,\n      parentHash: hash,\n      number: number,\n      timestamp: number,\n      nonce: Formatter.allowNull(hex),\n      difficulty: this.difficulty.bind(this),\n      gasLimit: bigNumber,\n      gasUsed: bigNumber,\n      miner: address,\n      extraData: data,\n      transactions: Formatter.allowNull(Formatter.arrayOf(hash)),\n      baseFeePerGas: Formatter.allowNull(bigNumber)\n    };\n    formats.blockWithTransactions = shallowCopy(formats.block);\n    formats.blockWithTransactions.transactions = Formatter.allowNull(Formatter.arrayOf(this.transactionResponse.bind(this)));\n    formats.filter = {\n      fromBlock: Formatter.allowNull(blockTag, undefined),\n      toBlock: Formatter.allowNull(blockTag, undefined),\n      blockHash: Formatter.allowNull(hash, undefined),\n      address: Formatter.allowNull(address, undefined),\n      topics: Formatter.allowNull(this.topics.bind(this), undefined)\n    };\n    formats.filterLog = {\n      blockNumber: Formatter.allowNull(number),\n      blockHash: Formatter.allowNull(hash),\n      transactionIndex: number,\n      removed: Formatter.allowNull(this.boolean.bind(this)),\n      address: address,\n      data: Formatter.allowFalsish(data, \"0x\"),\n      topics: Formatter.arrayOf(hash),\n      transactionHash: hash,\n      logIndex: number\n    };\n    return formats;\n  }\n\n  accessList(accessList) {\n    return accessListify(accessList || []);\n  } // Requires a BigNumberish that is within the IEEE754 safe integer range; returns a number\n  // Strict! Used on input.\n\n\n  number(number) {\n    if (number === \"0x\") {\n      return 0;\n    }\n\n    return BigNumber.from(number).toNumber();\n  }\n\n  type(number) {\n    if (number === \"0x\" || number == null) {\n      return 0;\n    }\n\n    return BigNumber.from(number).toNumber();\n  } // Strict! Used on input.\n\n\n  bigNumber(value) {\n    return BigNumber.from(value);\n  } // Requires a boolean, \"true\" or  \"false\"; returns a boolean\n\n\n  boolean(value) {\n    if (typeof value === \"boolean\") {\n      return value;\n    }\n\n    if (typeof value === \"string\") {\n      value = value.toLowerCase();\n\n      if (value === \"true\") {\n        return true;\n      }\n\n      if (value === \"false\") {\n        return false;\n      }\n    }\n\n    throw new Error(\"invalid boolean - \" + value);\n  }\n\n  hex(value, strict) {\n    if (typeof value === \"string\") {\n      if (!strict && value.substring(0, 2) !== \"0x\") {\n        value = \"0x\" + value;\n      }\n\n      if (isHexString(value)) {\n        return value.toLowerCase();\n      }\n    }\n\n    return logger.throwArgumentError(\"invalid hash\", \"value\", value);\n  }\n\n  data(value, strict) {\n    const result = this.hex(value, strict);\n\n    if (result.length % 2 !== 0) {\n      throw new Error(\"invalid data; odd-length - \" + value);\n    }\n\n    return result;\n  } // Requires an address\n  // Strict! Used on input.\n\n\n  address(value) {\n    return getAddress(value);\n  }\n\n  callAddress(value) {\n    if (!isHexString(value, 32)) {\n      return null;\n    }\n\n    const address = getAddress(hexDataSlice(value, 12));\n    return address === AddressZero ? null : address;\n  }\n\n  contractAddress(value) {\n    return getContractAddress(value);\n  } // Strict! Used on input.\n\n\n  blockTag(blockTag) {\n    if (blockTag == null) {\n      return \"latest\";\n    }\n\n    if (blockTag === \"earliest\") {\n      return \"0x0\";\n    }\n\n    if (blockTag === \"latest\" || blockTag === \"pending\") {\n      return blockTag;\n    }\n\n    if (typeof blockTag === \"number\" || isHexString(blockTag)) {\n      return hexValue(blockTag);\n    }\n\n    throw new Error(\"invalid blockTag\");\n  } // Requires a hash, optionally requires 0x prefix; returns prefixed lowercase hash.\n\n\n  hash(value, strict) {\n    const result = this.hex(value, strict);\n\n    if (hexDataLength(result) !== 32) {\n      return logger.throwArgumentError(\"invalid hash\", \"value\", value);\n    }\n\n    return result;\n  } // Returns the difficulty as a number, or if too large (i.e. PoA network) null\n\n\n  difficulty(value) {\n    if (value == null) {\n      return null;\n    }\n\n    const v = BigNumber.from(value);\n\n    try {\n      return v.toNumber();\n    } catch (error) {}\n\n    return null;\n  }\n\n  uint256(value) {\n    if (!isHexString(value)) {\n      throw new Error(\"invalid uint256\");\n    }\n\n    return hexZeroPad(value, 32);\n  }\n\n  _block(value, format) {\n    if (value.author != null && value.miner == null) {\n      value.miner = value.author;\n    } // The difficulty may need to come from _difficulty in recursed blocks\n\n\n    const difficulty = value._difficulty != null ? value._difficulty : value.difficulty;\n    const result = Formatter.check(format, value);\n    result._difficulty = difficulty == null ? null : BigNumber.from(difficulty);\n    return result;\n  }\n\n  block(value) {\n    return this._block(value, this.formats.block);\n  }\n\n  blockWithTransactions(value) {\n    return this._block(value, this.formats.blockWithTransactions);\n  } // Strict! Used on input.\n\n\n  transactionRequest(value) {\n    return Formatter.check(this.formats.transactionRequest, value);\n  }\n\n  transactionResponse(transaction) {\n    // Rename gas to gasLimit\n    if (transaction.gas != null && transaction.gasLimit == null) {\n      transaction.gasLimit = transaction.gas;\n    } // Some clients (TestRPC) do strange things like return 0x0 for the\n    // 0 address; correct this to be a real address\n\n\n    if (transaction.to && BigNumber.from(transaction.to).isZero()) {\n      transaction.to = \"0x0000000000000000000000000000000000000000\";\n    } // Rename input to data\n\n\n    if (transaction.input != null && transaction.data == null) {\n      transaction.data = transaction.input;\n    } // If to and creates are empty, populate the creates from the transaction\n\n\n    if (transaction.to == null && transaction.creates == null) {\n      transaction.creates = this.contractAddress(transaction);\n    }\n\n    if ((transaction.type === 1 || transaction.type === 2) && transaction.accessList == null) {\n      transaction.accessList = [];\n    }\n\n    const result = Formatter.check(this.formats.transaction, transaction);\n\n    if (transaction.chainId != null) {\n      let chainId = transaction.chainId;\n\n      if (isHexString(chainId)) {\n        chainId = BigNumber.from(chainId).toNumber();\n      }\n\n      result.chainId = chainId;\n    } else {\n      let chainId = transaction.networkId; // geth-etc returns chainId\n\n      if (chainId == null && result.v == null) {\n        chainId = transaction.chainId;\n      }\n\n      if (isHexString(chainId)) {\n        chainId = BigNumber.from(chainId).toNumber();\n      }\n\n      if (typeof chainId !== \"number\" && result.v != null) {\n        chainId = (result.v - 35) / 2;\n\n        if (chainId < 0) {\n          chainId = 0;\n        }\n\n        chainId = parseInt(chainId);\n      }\n\n      if (typeof chainId !== \"number\") {\n        chainId = 0;\n      }\n\n      result.chainId = chainId;\n    } // 0x0000... should actually be null\n\n\n    if (result.blockHash && result.blockHash.replace(/0/g, \"\") === \"x\") {\n      result.blockHash = null;\n    }\n\n    return result;\n  }\n\n  transaction(value) {\n    return parseTransaction(value);\n  }\n\n  receiptLog(value) {\n    return Formatter.check(this.formats.receiptLog, value);\n  }\n\n  receipt(value) {\n    const result = Formatter.check(this.formats.receipt, value); // RSK incorrectly implemented EIP-658, so we munge things a bit here for it\n\n    if (result.root != null) {\n      if (result.root.length <= 4) {\n        // Could be 0x00, 0x0, 0x01 or 0x1\n        const value = BigNumber.from(result.root).toNumber();\n\n        if (value === 0 || value === 1) {\n          // Make sure if both are specified, they match\n          if (result.status != null && result.status !== value) {\n            logger.throwArgumentError(\"alt-root-status/status mismatch\", \"value\", {\n              root: result.root,\n              status: result.status\n            });\n          }\n\n          result.status = value;\n          delete result.root;\n        } else {\n          logger.throwArgumentError(\"invalid alt-root-status\", \"value.root\", result.root);\n        }\n      } else if (result.root.length !== 66) {\n        // Must be a valid bytes32\n        logger.throwArgumentError(\"invalid root hash\", \"value.root\", result.root);\n      }\n    }\n\n    if (result.status != null) {\n      result.byzantium = true;\n    }\n\n    return result;\n  }\n\n  topics(value) {\n    if (Array.isArray(value)) {\n      return value.map(v => this.topics(v));\n    } else if (value != null) {\n      return this.hash(value, true);\n    }\n\n    return null;\n  }\n\n  filter(value) {\n    return Formatter.check(this.formats.filter, value);\n  }\n\n  filterLog(value) {\n    return Formatter.check(this.formats.filterLog, value);\n  }\n\n  static check(format, object) {\n    const result = {};\n\n    for (const key in format) {\n      try {\n        const value = format[key](object[key]);\n\n        if (value !== undefined) {\n          result[key] = value;\n        }\n      } catch (error) {\n        error.checkKey = key;\n        error.checkValue = object[key];\n        throw error;\n      }\n    }\n\n    return result;\n  } // if value is null-ish, nullValue is returned\n\n\n  static allowNull(format, nullValue) {\n    return function (value) {\n      if (value == null) {\n        return nullValue;\n      }\n\n      return format(value);\n    };\n  } // If value is false-ish, replaceValue is returned\n\n\n  static allowFalsish(format, replaceValue) {\n    return function (value) {\n      if (!value) {\n        return replaceValue;\n      }\n\n      return format(value);\n    };\n  } // Requires an Array satisfying check\n\n\n  static arrayOf(format) {\n    return function (array) {\n      if (!Array.isArray(array)) {\n        throw new Error(\"not an array\");\n      }\n\n      const result = [];\n      array.forEach(function (value) {\n        result.push(format(value));\n      });\n      return result;\n    };\n  }\n\n}\nexport function isCommunityResourcable(value) {\n  return value && typeof value.isCommunityResource === \"function\";\n}\nexport function isCommunityResource(value) {\n  return isCommunityResourcable(value) && value.isCommunityResource();\n} // Show the throttle message only once\n\nlet throttleMessage = false;\nexport function showThrottleMessage() {\n  if (throttleMessage) {\n    return;\n  }\n\n  throttleMessage = true;\n  console.log(\"========= NOTICE =========\");\n  console.log(\"Request-Rate Exceeded  (this message will not be repeated)\");\n  console.log(\"\");\n  console.log(\"The default API keys for each service are provided as a highly-throttled,\");\n  console.log(\"community resource for low-traffic projects and early prototyping.\");\n  console.log(\"\");\n  console.log(\"While your application will continue to function, we highly recommended\");\n  console.log(\"signing up for your own API keys to improve performance, increase your\");\n  console.log(\"request rate/limit and enable other perks, such as metrics and advanced APIs.\");\n  console.log(\"\");\n  console.log(\"For more details: https:/\\/docs.ethers.io/api-keys/\");\n  console.log(\"==========================\");\n}","map":{"version":3,"mappings":"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","names":["getAddress","getContractAddress","BigNumber","hexDataLength","hexDataSlice","hexValue","hexZeroPad","isHexString","AddressZero","shallowCopy","accessListify","parse","parseTransaction","Logger","version","logger","Formatter","constructor","checkNew","new","target","formats","getDefaultFormats","address","bind","bigNumber","blockTag","data","hash","hex","number","type","strictData","v","transaction","accessList","allowNull","blockHash","blockNumber","transactionIndex","confirmations","from","gasPrice","maxPriorityFeePerGas","maxFeePerGas","gasLimit","to","value","nonce","r","uint256","s","creates","raw","transactionRequest","receiptLog","transactionHash","topics","arrayOf","logIndex","receipt","contractAddress","root","gasUsed","logsBloom","logs","cumulativeGasUsed","effectiveGasPrice","status","block","parentHash","timestamp","difficulty","miner","extraData","transactions","baseFeePerGas","blockWithTransactions","transactionResponse","filter","fromBlock","undefined","toBlock","filterLog","removed","boolean","allowFalsish","toNumber","toLowerCase","Error","strict","substring","throwArgumentError","result","length","callAddress","error","_block","format","author","_difficulty","check","gas","isZero","input","chainId","networkId","parseInt","replace","byzantium","Array","isArray","map","object","key","checkKey","checkValue","nullValue","replaceValue","array","forEach","push","isCommunityResourcable","isCommunityResource","throttleMessage","showThrottleMessage","console","log"],"sources":["E:\\6883proj\\6883project\\node_modules\\@ethersproject\\providers\\src.ts\\formatter.ts"],"sourcesContent":["\"use strict\";\r\n\r\nimport { Block, TransactionReceipt, TransactionResponse } from \"@ethersproject/abstract-provider\";\r\nimport { getAddress, getContractAddress } from \"@ethersproject/address\";\r\nimport { BigNumber } from \"@ethersproject/bignumber\";\r\nimport { hexDataLength, hexDataSlice, hexValue, hexZeroPad, isHexString } from \"@ethersproject/bytes\";\r\nimport { AddressZero } from \"@ethersproject/constants\";\r\nimport { shallowCopy } from \"@ethersproject/properties\";\r\nimport { AccessList, accessListify, parse as parseTransaction } from \"@ethersproject/transactions\";\r\n\r\nimport { Logger } from \"@ethersproject/logger\";\r\nimport { version } from \"./_version\";\r\nconst logger = new Logger(version);\r\n\r\nexport type FormatFunc = (value: any) => any;\r\n\r\nexport type FormatFuncs = { [ key: string ]: FormatFunc };\r\n\r\nexport type Formats = {\r\n    transaction: FormatFuncs,\r\n    transactionRequest: FormatFuncs,\r\n    receipt: FormatFuncs,\r\n    receiptLog: FormatFuncs,\r\n    block: FormatFuncs,\r\n    blockWithTransactions: FormatFuncs,\r\n    filter: FormatFuncs,\r\n    filterLog: FormatFuncs,\r\n};\r\n\r\nexport class Formatter {\r\n    readonly formats: Formats;\r\n\r\n    constructor() {\r\n        logger.checkNew(new.target, Formatter);\r\n        this.formats = this.getDefaultFormats();\r\n    }\r\n\r\n    getDefaultFormats(): Formats {\r\n        const formats: Formats = <Formats>({ });\r\n\r\n        const address = this.address.bind(this);\r\n        const bigNumber = this.bigNumber.bind(this);\r\n        const blockTag = this.blockTag.bind(this);\r\n        const data = this.data.bind(this);\r\n        const hash = this.hash.bind(this);\r\n        const hex = this.hex.bind(this);\r\n        const number = this.number.bind(this);\r\n        const type = this.type.bind(this);\r\n\r\n        const strictData = (v: any) => { return this.data(v, true); };\r\n\r\n        formats.transaction = {\r\n            hash: hash,\r\n\r\n            type: type,\r\n            accessList: Formatter.allowNull(this.accessList.bind(this), null),\r\n\r\n            blockHash: Formatter.allowNull(hash, null),\r\n            blockNumber: Formatter.allowNull(number, null),\r\n            transactionIndex: Formatter.allowNull(number, null),\r\n\r\n            confirmations: Formatter.allowNull(number, null),\r\n\r\n            from: address,\r\n\r\n            // either (gasPrice) or (maxPriorityFeePerGas + maxFeePerGas)\r\n            // must be set\r\n            gasPrice: Formatter.allowNull(bigNumber),\r\n            maxPriorityFeePerGas: Formatter.allowNull(bigNumber),\r\n            maxFeePerGas: Formatter.allowNull(bigNumber),\r\n\r\n            gasLimit: bigNumber,\r\n            to: Formatter.allowNull(address, null),\r\n            value: bigNumber,\r\n            nonce: number,\r\n            data: data,\r\n\r\n            r: Formatter.allowNull(this.uint256),\r\n            s: Formatter.allowNull(this.uint256),\r\n            v: Formatter.allowNull(number),\r\n\r\n            creates: Formatter.allowNull(address, null),\r\n\r\n            raw: Formatter.allowNull(data),\r\n        };\r\n\r\n        formats.transactionRequest = {\r\n            from: Formatter.allowNull(address),\r\n            nonce: Formatter.allowNull(number),\r\n            gasLimit: Formatter.allowNull(bigNumber),\r\n            gasPrice: Formatter.allowNull(bigNumber),\r\n            maxPriorityFeePerGas: Formatter.allowNull(bigNumber),\r\n            maxFeePerGas: Formatter.allowNull(bigNumber),\r\n            to: Formatter.allowNull(address),\r\n            value: Formatter.allowNull(bigNumber),\r\n            data: Formatter.allowNull(strictData),\r\n            type: Formatter.allowNull(number),\r\n            accessList: Formatter.allowNull(this.accessList.bind(this), null),\r\n        };\r\n\r\n        formats.receiptLog = {\r\n            transactionIndex: number,\r\n            blockNumber: number,\r\n            transactionHash: hash,\r\n            address: address,\r\n            topics: Formatter.arrayOf(hash),\r\n            data: data,\r\n            logIndex: number,\r\n            blockHash: hash,\r\n        };\r\n\r\n        formats.receipt = {\r\n            to: Formatter.allowNull(this.address, null),\r\n            from: Formatter.allowNull(this.address, null),\r\n            contractAddress: Formatter.allowNull(address, null),\r\n            transactionIndex: number,\r\n            // should be allowNull(hash), but broken-EIP-658 support is handled in receipt\r\n            root: Formatter.allowNull(hex),\r\n            gasUsed: bigNumber,\r\n            logsBloom: Formatter.allowNull(data),// @TODO: should this be data?\r\n            blockHash: hash,\r\n            transactionHash: hash,\r\n            logs: Formatter.arrayOf(this.receiptLog.bind(this)),\r\n            blockNumber: number,\r\n            confirmations: Formatter.allowNull(number, null),\r\n            cumulativeGasUsed: bigNumber,\r\n            effectiveGasPrice: Formatter.allowNull(bigNumber),\r\n            status: Formatter.allowNull(number),\r\n            type: type\r\n        };\r\n\r\n        formats.block = {\r\n            hash: hash,\r\n            parentHash: hash,\r\n            number: number,\r\n\r\n            timestamp: number,\r\n            nonce: Formatter.allowNull(hex),\r\n            difficulty: this.difficulty.bind(this),\r\n\r\n            gasLimit: bigNumber,\r\n            gasUsed: bigNumber,\r\n\r\n            miner: address,\r\n            extraData: data,\r\n\r\n            transactions: Formatter.allowNull(Formatter.arrayOf(hash)),\r\n\r\n            baseFeePerGas: Formatter.allowNull(bigNumber)\r\n        };\r\n\r\n        formats.blockWithTransactions = shallowCopy(formats.block);\r\n        formats.blockWithTransactions.transactions = Formatter.allowNull(Formatter.arrayOf(this.transactionResponse.bind(this)));\r\n\r\n        formats.filter = {\r\n            fromBlock: Formatter.allowNull(blockTag, undefined),\r\n            toBlock: Formatter.allowNull(blockTag, undefined),\r\n            blockHash: Formatter.allowNull(hash, undefined),\r\n            address: Formatter.allowNull(address, undefined),\r\n            topics: Formatter.allowNull(this.topics.bind(this), undefined),\r\n        };\r\n\r\n        formats.filterLog = {\r\n            blockNumber: Formatter.allowNull(number),\r\n            blockHash: Formatter.allowNull(hash),\r\n            transactionIndex: number,\r\n\r\n            removed: Formatter.allowNull(this.boolean.bind(this)),\r\n\r\n            address: address,\r\n            data: Formatter.allowFalsish(data, \"0x\"),\r\n\r\n            topics: Formatter.arrayOf(hash),\r\n\r\n            transactionHash: hash,\r\n            logIndex: number,\r\n        };\r\n\r\n        return formats;\r\n    }\r\n\r\n    accessList(accessList: Array<any>): AccessList {\r\n        return accessListify(accessList || []);\r\n    }\r\n\r\n    // Requires a BigNumberish that is within the IEEE754 safe integer range; returns a number\r\n    // Strict! Used on input.\r\n    number(number: any): number {\r\n        if (number === \"0x\") { return 0; }\r\n        return BigNumber.from(number).toNumber();\r\n    }\r\n\r\n    type(number: any): number {\r\n        if (number === \"0x\" || number == null) { return 0; }\r\n        return BigNumber.from(number).toNumber();\r\n    }\r\n\r\n    // Strict! Used on input.\r\n    bigNumber(value: any): BigNumber {\r\n        return BigNumber.from(value);\r\n    }\r\n\r\n    // Requires a boolean, \"true\" or  \"false\"; returns a boolean\r\n    boolean(value: any): boolean {\r\n        if (typeof(value) === \"boolean\") { return value; }\r\n        if (typeof(value) === \"string\") {\r\n            value = value.toLowerCase();\r\n            if (value === \"true\") { return true; }\r\n            if (value === \"false\") { return false; }\r\n        }\r\n        throw new Error(\"invalid boolean - \" + value);\r\n    }\r\n\r\n    hex(value: any, strict?: boolean): string {\r\n        if (typeof(value) === \"string\") {\r\n            if (!strict && value.substring(0, 2) !== \"0x\") { value = \"0x\" + value; }\r\n            if (isHexString(value)) {\r\n               return value.toLowerCase();\r\n            }\r\n        }\r\n        return logger.throwArgumentError(\"invalid hash\", \"value\", value);\r\n    }\r\n\r\n    data(value: any, strict?: boolean): string {\r\n        const result = this.hex(value, strict);\r\n        if ((result.length % 2) !== 0) {\r\n            throw new Error(\"invalid data; odd-length - \" + value);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    // Requires an address\r\n    // Strict! Used on input.\r\n    address(value: any): string {\r\n        return getAddress(value);\r\n    }\r\n\r\n    callAddress(value: any): string {\r\n        if (!isHexString(value, 32)) { return null; }\r\n        const address = getAddress(hexDataSlice(value, 12));\r\n        return (address === AddressZero) ? null: address;\r\n    }\r\n\r\n    contractAddress(value: any): string {\r\n        return getContractAddress(value);\r\n    }\r\n\r\n    // Strict! Used on input.\r\n    blockTag(blockTag: any): string {\r\n        if (blockTag == null) { return \"latest\"; }\r\n\r\n        if (blockTag === \"earliest\") { return \"0x0\"; }\r\n\r\n        if (blockTag === \"latest\" || blockTag === \"pending\") {\r\n            return blockTag;\r\n        }\r\n\r\n        if (typeof(blockTag) === \"number\" || isHexString(blockTag)) {\r\n            return hexValue(<number | string>blockTag);\r\n        }\r\n\r\n        throw new Error(\"invalid blockTag\");\r\n    }\r\n\r\n    // Requires a hash, optionally requires 0x prefix; returns prefixed lowercase hash.\r\n    hash(value: any, strict?: boolean): string {\r\n        const result = this.hex(value, strict);\r\n        if (hexDataLength(result) !== 32) {\r\n            return logger.throwArgumentError(\"invalid hash\", \"value\", value);\r\n        }\r\n        return result;\r\n    }\r\n\r\n    // Returns the difficulty as a number, or if too large (i.e. PoA network) null\r\n    difficulty(value: any): number {\r\n        if (value == null) { return null; }\r\n\r\n        const v = BigNumber.from(value);\r\n\r\n        try {\r\n            return v.toNumber();\r\n        } catch (error) { }\r\n\r\n       return null;\r\n    }\r\n\r\n    uint256(value: any): string {\r\n        if (!isHexString(value)) {\r\n            throw new Error(\"invalid uint256\");\r\n        }\r\n        return hexZeroPad(value, 32);\r\n    }\r\n\r\n    _block(value: any, format: any): Block {\r\n        if (value.author != null && value.miner == null) {\r\n            value.miner = value.author;\r\n        }\r\n        // The difficulty may need to come from _difficulty in recursed blocks\r\n        const difficulty = (value._difficulty != null) ? value._difficulty: value.difficulty;\r\n        const result = Formatter.check(format, value);\r\n        result._difficulty = ((difficulty == null) ? null: BigNumber.from(difficulty));\r\n        return result;\r\n    }\r\n\r\n    block(value: any): Block {\r\n        return this._block(value, this.formats.block);\r\n    }\r\n\r\n    blockWithTransactions(value: any): Block {\r\n        return this._block(value, this.formats.blockWithTransactions);\r\n    }\r\n\r\n    // Strict! Used on input.\r\n    transactionRequest(value: any): any {\r\n        return Formatter.check(this.formats.transactionRequest, value);\r\n    }\r\n\r\n    transactionResponse(transaction: any): TransactionResponse {\r\n\r\n        // Rename gas to gasLimit\r\n        if (transaction.gas != null && transaction.gasLimit == null) {\r\n            transaction.gasLimit = transaction.gas;\r\n        }\r\n\r\n        // Some clients (TestRPC) do strange things like return 0x0 for the\r\n        // 0 address; correct this to be a real address\r\n        if (transaction.to && BigNumber.from(transaction.to).isZero()) {\r\n            transaction.to = \"0x0000000000000000000000000000000000000000\";\r\n        }\r\n\r\n        // Rename input to data\r\n        if (transaction.input != null && transaction.data == null) {\r\n            transaction.data = transaction.input;\r\n        }\r\n\r\n        // If to and creates are empty, populate the creates from the transaction\r\n        if (transaction.to == null && transaction.creates == null) {\r\n            transaction.creates = this.contractAddress(transaction);\r\n        }\r\n\r\n        if ((transaction.type === 1 || transaction.type === 2)&& transaction.accessList == null) {\r\n            transaction.accessList = [ ];\r\n        }\r\n\r\n        const result: TransactionResponse = Formatter.check(this.formats.transaction, transaction);\r\n\r\n        if (transaction.chainId != null) {\r\n            let chainId = transaction.chainId;\r\n\r\n            if (isHexString(chainId)) {\r\n                chainId = BigNumber.from(chainId).toNumber();\r\n            }\r\n\r\n            result.chainId = chainId;\r\n\r\n        } else {\r\n            let chainId = transaction.networkId;\r\n\r\n            // geth-etc returns chainId\r\n            if (chainId == null && result.v == null) {\r\n                chainId = transaction.chainId;\r\n            }\r\n\r\n            if (isHexString(chainId)) {\r\n                chainId = BigNumber.from(chainId).toNumber();\r\n            }\r\n\r\n            if (typeof(chainId) !== \"number\" && result.v != null) {\r\n                chainId = (result.v - 35) / 2;\r\n                if (chainId < 0) { chainId = 0; }\r\n                chainId = parseInt(chainId);\r\n            }\r\n\r\n            if (typeof(chainId) !== \"number\") { chainId = 0; }\r\n\r\n            result.chainId = chainId;\r\n        }\r\n\r\n        // 0x0000... should actually be null\r\n        if (result.blockHash && result.blockHash.replace(/0/g, \"\") === \"x\") {\r\n            result.blockHash = null;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    transaction(value: any): any {\r\n        return parseTransaction(value);\r\n    }\r\n\r\n    receiptLog(value: any): any {\r\n        return Formatter.check(this.formats.receiptLog, value);\r\n    }\r\n\r\n    receipt(value: any): TransactionReceipt {\r\n        const result: TransactionReceipt = Formatter.check(this.formats.receipt, value);\r\n\r\n        // RSK incorrectly implemented EIP-658, so we munge things a bit here for it\r\n        if (result.root != null) {\r\n            if (result.root.length <= 4) {\r\n                // Could be 0x00, 0x0, 0x01 or 0x1\r\n                const value = BigNumber.from(result.root).toNumber();\r\n                if (value === 0 || value === 1) {\r\n                    // Make sure if both are specified, they match\r\n                    if (result.status != null && (result.status !== value)) {\r\n                        logger.throwArgumentError(\"alt-root-status/status mismatch\", \"value\", { root: result.root, status: result.status });\r\n                    }\r\n                    result.status = value;\r\n                    delete result.root;\r\n                } else {\r\n                    logger.throwArgumentError(\"invalid alt-root-status\", \"value.root\", result.root);\r\n                }\r\n            } else if (result.root.length !== 66) {\r\n                // Must be a valid bytes32\r\n                logger.throwArgumentError(\"invalid root hash\", \"value.root\", result.root);\r\n            }\r\n        }\r\n\r\n        if (result.status != null) {\r\n            result.byzantium = true;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    topics(value: any): any {\r\n        if (Array.isArray(value)) {\r\n            return value.map((v) => this.topics(v));\r\n\r\n        } else if (value != null) {\r\n            return this.hash(value, true);\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    filter(value: any): any {\r\n        return Formatter.check(this.formats.filter, value);\r\n    }\r\n\r\n    filterLog(value: any): any {\r\n        return Formatter.check(this.formats.filterLog, value);\r\n    }\r\n\r\n    static check(format: { [ name: string ]: FormatFunc }, object: any): any {\r\n        const result: any = {};\r\n        for (const key in format) {\r\n            try {\r\n                const value = format[key](object[key]);\r\n                if (value !== undefined) { result[key] = value; }\r\n            } catch (error) {\r\n                error.checkKey = key;\r\n                error.checkValue = object[key];\r\n                throw error;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    // if value is null-ish, nullValue is returned\r\n    static allowNull(format: FormatFunc, nullValue?: any): FormatFunc {\r\n        return (function(value: any) {\r\n            if (value == null) { return nullValue; }\r\n            return format(value);\r\n        });\r\n    }\r\n\r\n    // If value is false-ish, replaceValue is returned\r\n    static allowFalsish(format: FormatFunc, replaceValue: any): FormatFunc {\r\n        return (function(value: any) {\r\n            if (!value) { return replaceValue; }\r\n            return format(value);\r\n        });\r\n    }\r\n\r\n    // Requires an Array satisfying check\r\n    static arrayOf(format: FormatFunc): FormatFunc {\r\n        return (function(array: any): Array<any> {\r\n            if (!Array.isArray(array)) { throw new Error(\"not an array\"); }\r\n\r\n            const result: any = [];\r\n\r\n            array.forEach(function(value) {\r\n                result.push(format(value));\r\n            });\r\n\r\n            return result;\r\n        });\r\n    }\r\n}\r\n\r\nexport interface CommunityResourcable {\r\n    isCommunityResource(): boolean;\r\n}\r\n\r\nexport function isCommunityResourcable(value: any): value is CommunityResourcable {\r\n    return (value && typeof(value.isCommunityResource) === \"function\");\r\n}\r\n\r\nexport function isCommunityResource(value: any): boolean {\r\n    return (isCommunityResourcable(value) && value.isCommunityResource());\r\n}\r\n\r\n// Show the throttle message only once\r\nlet throttleMessage = false;\r\nexport function showThrottleMessage() {\r\n    if (throttleMessage) { return; }\r\n    throttleMessage = true;\r\n\r\n    console.log(\"========= NOTICE =========\")\r\n    console.log(\"Request-Rate Exceeded  (this message will not be repeated)\");\r\n    console.log(\"\");\r\n    console.log(\"The default API keys for each service are provided as a highly-throttled,\");\r\n    console.log(\"community resource for low-traffic projects and early prototyping.\");\r\n    console.log(\"\");\r\n    console.log(\"While your application will continue to function, we highly recommended\");\r\n    console.log(\"signing up for your own API keys to improve performance, increase your\");\r\n    console.log(\"request rate/limit and enable other perks, such as metrics and advanced APIs.\");\r\n    console.log(\"\");\r\n    console.log(\"For more details: https:/\\/docs.ethers.io/api-keys/\");\r\n    console.log(\"==========================\");\r\n}\r\n\r\n"]},"metadata":{},"sourceType":"module"}