{"ast":null,"code":"var _jsxFileName = \"E:\\\\6883proj\\\\6883project\\\\src\\\\frontend\\\\components\\\\Home.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect, useRef } from 'react';\nimport { ethers } from \"ethers\";\nimport { Card, Button, ButtonGroup, Image, Carousel } from 'react-bootstrap';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Home = _ref => {\n  _s();\n\n  let {\n    contract\n  } = _ref;\n  const audioRef = useRef(null);\n  const [loading, setLoading] = useState(true);\n  const [isPlaying, setIsPlaying] = useState(null);\n  const [currentItemIndex, setCurrentItemIndex] = useState(0);\n  const [marketItems, setMarketItems] = useState(null);\n\n  const loadMarketplaceItems = async () => {\n    // Get all unsold items/tokens\n    const results = await contract.getAllUnsoldTokens();\n    const marketItems = await Promise.all(results.map(async i => {\n      // get uri url from contract\n      const uri = await contract.tokenURI(i.tokenId); // use uri to fetch the nft metadata stored on ipfs \n\n      const response = await fetch(uri + \".json\");\n      const metadata = await response.json(); // define item object\n\n      let item = {\n        price: i.price,\n        itemId: i.tokenId,\n        name: metadata.name,\n        audio: metadata.audio,\n        cover: metadata.cover\n      };\n      return item;\n    }));\n    setMarketItems(marketItems);\n    setLoading(false);\n  };\n\n  const buyMarketItem = async item => {\n    await (await contract.buyToken(item.itemId, {\n      value: item.price\n    })).wait();\n    loadMarketplaceItems();\n  };\n\n  const skipSong = forwards => {\n    if (forwards) {\n      setCurrentItemIndex(() => {\n        let index = currentItemIndex;\n        index++;\n\n        if (index > marketItems.length - 1) {\n          index = 0;\n        }\n\n        return index;\n      });\n    } else {\n      setCurrentItemIndex(() => {\n        let index = currentItemIndex;\n        index--;\n\n        if (index < 0) {\n          index = marketItems.length - 1;\n        }\n\n        return index;\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (isPlaying) {\n      audioRef.current.play();\n    } else if (isPlaying !== null) {\n      audioRef.current.pause();\n    }\n  });\n  useEffect(() => {\n    !marketItems && loadMarketplaceItems();\n  });\n  if (loading) return /*#__PURE__*/_jsxDEV(\"main\", {\n    style: {\n      padding: \"1rem 0\"\n    },\n    children: /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 5\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container-fluid mt-5\",\n    children: marketItems.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row\",\n      children: /*#__PURE__*/_jsxDEV(\"main\", {\n        role: \"main\",\n        className: \"col-lg-12 mx-auto\",\n        style: {\n          maxWidth: '500px'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"content mx-auto\",\n          children: [/*#__PURE__*/_jsxDEV(\"audio\", {\n            src: marketItems[currentItemIndex].audio,\n            ref: audioRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Carousel, {\n            children: /*#__PURE__*/_jsxDEV(Carousel.Item, {\n              children: /*#__PURE__*/_jsxDEV(Card, {\n                children: [/*#__PURE__*/_jsxDEV(Card.Header, {\n                  children: [currentItemIndex + 1, \" of \", marketItems.length]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 86,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Card.Img, {\n                  className: \"card-img-top\",\n                  src: marketItems[currentItemIndex].cover\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 87,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Card.Body, {\n                  color: \"primary\",\n                  children: [/*#__PURE__*/_jsxDEV(Card.Title, {\n                    as: \"h2\",\n                    children: [\" \", marketItems[currentItemIndex].name]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 89,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"d-grid px-4\",\n                    children: /*#__PURE__*/_jsxDEV(ButtonGroup, {\n                      size: \"lg\",\n                      \"aria-label\": \"Basic example\",\n                      children: [/*#__PURE__*/_jsxDEV(Button, {\n                        variant: \"warning\",\n                        onClick: () => skipSong(false),\n                        children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                          xmlns: \"http://www.w3.org/2000/svg\",\n                          width: \"32\",\n                          height: \"32\",\n                          fill: \"currentColor\",\n                          className: \"bi bi-skip-backward\",\n                          viewBox: \"0 0 16 16\",\n                          children: /*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M.5 3.5A.5.5 0 0 1 1 4v3.248l6.267-3.636c.52-.302 1.233.043 1.233.696v2.94l6.267-3.636c.52-.302 1.233.043 1.233.696v7.384c0 .653-.713.998-1.233.696L8.5 8.752v2.94c0 .653-.713.998-1.233.696L1 8.752V12a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm7 1.133L1.696 8 7.5 11.367V4.633zm7.5 0L9.196 8 15 11.367V4.633z\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 94,\n                            columnNumber: 31\n                          }, this)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 93,\n                          columnNumber: 29\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 92,\n                        columnNumber: 27\n                      }, this), /*#__PURE__*/_jsxDEV(Button, {\n                        variant: \"warning\",\n                        onClick: () => setIsPlaying(!isPlaying),\n                        children: isPlaying ? /*#__PURE__*/_jsxDEV(\"svg\", {\n                          xmlns: \"http://www.w3.org/2000/svg\",\n                          width: \"32\",\n                          height: \"32\",\n                          fill: \"currentColor\",\n                          className: \"bi bi-pause\",\n                          viewBox: \"0 0 16 16\",\n                          children: /*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 100,\n                            columnNumber: 33\n                          }, this)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 99,\n                          columnNumber: 31\n                        }, this) : /*#__PURE__*/_jsxDEV(\"svg\", {\n                          xmlns: \"http://www.w3.org/2000/svg\",\n                          width: \"32\",\n                          height: \"32\",\n                          fill: \"currentColor\",\n                          className: \"bi bi-play\",\n                          viewBox: \"0 0 16 16\",\n                          children: /*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 104,\n                            columnNumber: 33\n                          }, this)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 103,\n                          columnNumber: 31\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 97,\n                        columnNumber: 27\n                      }, this), /*#__PURE__*/_jsxDEV(Button, {\n                        variant: \"warning\",\n                        onClick: () => skipSong(true),\n                        children: /*#__PURE__*/_jsxDEV(\"svg\", {\n                          xmlns: \"http://www.w3.org/2000/svg\",\n                          width: \"32\",\n                          height: \"32\",\n                          fill: \"currentColor\",\n                          className: \"bi bi-skip-forward\",\n                          viewBox: \"0 0 16 16\",\n                          children: /*#__PURE__*/_jsxDEV(\"path\", {\n                            d: \"M15.5 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V8.752l-6.267 3.636c-.52.302-1.233-.043-1.233-.696v-2.94l-6.267 3.636C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696L7.5 7.248v-2.94c0-.653.713-.998 1.233-.696L15 7.248V4a.5.5 0 0 1 .5-.5zM1 4.633v6.734L6.804 8 1 4.633zm7.5 0v6.734L14.304 8 8.5 4.633z\"\n                          }, void 0, false, {\n                            fileName: _jsxFileName,\n                            lineNumber: 110,\n                            columnNumber: 31\n                          }, this)\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 109,\n                          columnNumber: 29\n                        }, this)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 108,\n                        columnNumber: 27\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 91,\n                      columnNumber: 25\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 90,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 88,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Card.Footer, {\n                  children: /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"d-grid my-1\",\n                    children: /*#__PURE__*/_jsxDEV(Button, {\n                      onClick: () => buyMarketItem(marketItems[currentItemIndex]),\n                      variant: \"warning\",\n                      size: \"lg\",\n                      children: `Buy for ${ethers.utils.formatEther(marketItems[currentItemIndex].price)} ETH`\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 118,\n                      columnNumber: 25\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 117,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 116,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 85,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 84,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"main\", {\n      style: {\n        padding: \"1rem 0\"\n      },\n      children: /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"No listed assets\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 11\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 76,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Home, \"tJEck30DZbp4E/jeFRbIbVdXVhM=\");\n\n_c = Home;\nexport default Home;\n\nvar _c;\n\n$RefreshReg$(_c, \"Home\");","map":{"version":3,"sources":["E:/6883proj/6883project/src/frontend/components/Home.js"],"names":["useState","useEffect","useRef","ethers","Card","Button","ButtonGroup","Image","Carousel","Home","contract","audioRef","loading","setLoading","isPlaying","setIsPlaying","currentItemIndex","setCurrentItemIndex","marketItems","setMarketItems","loadMarketplaceItems","results","getAllUnsoldTokens","Promise","all","map","i","uri","tokenURI","tokenId","response","fetch","metadata","json","item","price","itemId","name","audio","cover","buyMarketItem","buyToken","value","wait","skipSong","forwards","index","length","current","play","pause","padding","maxWidth","utils","formatEther"],"mappings":"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","sourcesContent":["import { useState, useEffect, useRef } from 'react'\r\nimport { ethers } from \"ethers\"\r\nimport { Card, Button, ButtonGroup, Image, Carousel } from 'react-bootstrap'\r\n\r\nconst Home = ({ contract }) => {\r\n  const audioRef = useRef(null);\r\n  const [loading, setLoading] = useState(true)\r\n  const [isPlaying, setIsPlaying] = useState(null)\r\n  const [currentItemIndex, setCurrentItemIndex] = useState(0)\r\n  const [marketItems, setMarketItems] = useState(null)\r\n  const loadMarketplaceItems = async () => {\r\n    // Get all unsold items/tokens\r\n    const results = await contract.getAllUnsoldTokens()\r\n    const marketItems = await Promise.all(results.map(async i => {\r\n      // get uri url from contract\r\n      const uri = await contract.tokenURI(i.tokenId)\r\n      // use uri to fetch the nft metadata stored on ipfs \r\n      const response = await fetch(uri + \".json\")\r\n      const metadata = await response.json()\r\n      // define item object\r\n      let item = {\r\n        price: i.price,\r\n        itemId: i.tokenId,\r\n        name: metadata.name,\r\n        audio: metadata.audio,\r\n        cover: metadata.cover\r\n      }\r\n      return item\r\n    }))\r\n    setMarketItems(marketItems)\r\n    setLoading(false)\r\n  }\r\n  const buyMarketItem = async (item) => {\r\n    await (await contract.buyToken(item.itemId, { value: item.price })).wait()\r\n    loadMarketplaceItems()\r\n  }\r\n  const skipSong = (forwards) => {\r\n    if (forwards) {\r\n      setCurrentItemIndex(() => {\r\n        let index = currentItemIndex\r\n        index++\r\n        if (index > marketItems.length - 1) {\r\n          index = 0;\r\n        }\r\n        return index\r\n      })\r\n    } else {\r\n      setCurrentItemIndex(() => {\r\n        let index = currentItemIndex\r\n        index--\r\n        if (index < 0) {\r\n          index = marketItems.length - 1;\r\n        }\r\n        return index\r\n      })\r\n    }\r\n  }\r\n  useEffect(() => {\r\n    if (isPlaying) {\r\n      audioRef.current.play()\r\n    } else if (isPlaying !== null) {\r\n      audioRef.current.pause()\r\n    }\r\n  })\r\n  useEffect(() => {\r\n    !marketItems && loadMarketplaceItems()\r\n  })\r\n\r\n  if (loading) return (\r\n    <main style={{ padding: \"1rem 0\" }}>\r\n      <h2>Loading...</h2>\r\n    </main>\r\n  )\r\n  return (\r\n\r\n    <div className=\"container-fluid mt-5\">\r\n\r\n      {marketItems.length > 0 ?\r\n        <div className=\"row\">\r\n          <main role=\"main\" className=\"col-lg-12 mx-auto\" style={{ maxWidth: '500px' }}>\r\n            <div className=\"content mx-auto\">\r\n              <audio src={marketItems[currentItemIndex].audio} ref={audioRef}></audio>\r\n              <Carousel>\r\n                <Carousel.Item>\r\n                  <Card>\r\n                    <Card.Header>{currentItemIndex + 1} of {marketItems.length}</Card.Header>\r\n                    <Card.Img className=\"card-img-top\" src={marketItems[currentItemIndex].cover}/>\r\n                    <Card.Body color=\"primary\">\r\n                      <Card.Title as=\"h2\" > {marketItems[currentItemIndex].name}</Card.Title>\r\n                      <div className=\"d-grid px-4\">\r\n                        <ButtonGroup size=\"lg\" aria-label=\"Basic example\">\r\n                          <Button variant=\"warning\" onClick={() => skipSong(false)}>\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" fill=\"currentColor\" className=\"bi bi-skip-backward\" viewBox=\"0 0 16 16\">\r\n                              <path d=\"M.5 3.5A.5.5 0 0 1 1 4v3.248l6.267-3.636c.52-.302 1.233.043 1.233.696v2.94l6.267-3.636c.52-.302 1.233.043 1.233.696v7.384c0 .653-.713.998-1.233.696L8.5 8.752v2.94c0 .653-.713.998-1.233.696L1 8.752V12a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm7 1.133L1.696 8 7.5 11.367V4.633zm7.5 0L9.196 8 15 11.367V4.633z\" />\r\n                            </svg>\r\n                          </Button>\r\n                          <Button variant=\"warning\" onClick={() => setIsPlaying(!isPlaying)}>\r\n                            {isPlaying ? (\r\n                              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" fill=\"currentColor\" className=\"bi bi-pause\" viewBox=\"0 0 16 16\">\r\n                                <path d=\"M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z\" />\r\n                              </svg>\r\n                            ) : (\r\n                              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" fill=\"currentColor\" className=\"bi bi-play\" viewBox=\"0 0 16 16\">\r\n                                <path d=\"M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z\" />\r\n                              </svg>\r\n                            )}\r\n                          </Button>\r\n                          <Button variant=\"warning\" onClick={() => skipSong(true)}>\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" fill=\"currentColor\" className=\"bi bi-skip-forward\" viewBox=\"0 0 16 16\">\r\n                              <path d=\"M15.5 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V8.752l-6.267 3.636c-.52.302-1.233-.043-1.233-.696v-2.94l-6.267 3.636C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696L7.5 7.248v-2.94c0-.653.713-.998 1.233-.696L15 7.248V4a.5.5 0 0 1 .5-.5zM1 4.633v6.734L6.804 8 1 4.633zm7.5 0v6.734L14.304 8 8.5 4.633z\" />\r\n                            </svg>\r\n                          </Button>\r\n                        </ButtonGroup>\r\n                      </div>\r\n                    </Card.Body>\r\n                    <Card.Footer>\r\n                      <div className='d-grid my-1'>\r\n                        <Button onClick={() => buyMarketItem(marketItems[currentItemIndex])} variant=\"warning\" size=\"lg\">\r\n                          {`Buy for ${ethers.utils.formatEther(marketItems[currentItemIndex].price)} ETH`}\r\n                        </Button>\r\n                      </div>\r\n                    </Card.Footer>\r\n                  </Card>\r\n                </Carousel.Item>\r\n              </Carousel>\r\n            </div>\r\n          </main >\r\n        </div >\r\n        : (\r\n          <main style={{ padding: \"1rem 0\" }}>\r\n            <h2>No listed assets</h2>\r\n          </main>\r\n        )}\r\n\r\n    </div >\r\n  );\r\n}\r\nexport default Home\r\n"]},"metadata":{},"sourceType":"module"}