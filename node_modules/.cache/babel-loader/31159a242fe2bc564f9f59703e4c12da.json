{"ast":null,"code":"var _jsxFileName = \"/Users/cengwenxin/Desktop/6883project/src/frontend/components/MyTokens.js\",\n    _s = $RefreshSig$();\n\nimport { useState, useEffect, useRef } from 'react';\nimport { ethers } from \"ethers\";\nimport Identicon from 'identicon.js';\nimport { Row, Col, Card, Button, InputGroup, Form } from 'react-bootstrap';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function MyTokens(_ref) {\n  _s();\n\n  let {\n    contract\n  } = _ref;\n  const audioRefs = useRef([]);\n  const [isPlaying, setIsPlaying] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [myTokens, setMyTokens] = useState(null);\n  const [selected, setSelected] = useState(0);\n  const [previous, setPrevious] = useState(null);\n  const [resellId, setResellId] = useState(null);\n  const [resellPrice, setResellPrice] = useState(null);\n\n  const loadMyTokens = async () => {\n    // Get all unsold items/tokens\n    const results = await contract.getMyTokens();\n    const myTokens = await Promise.all(results.map(async i => {\n      if (i.tokenId != 3) {\n        // get uri url from contract\n        const uri = await contract.tokenURI(i.tokenId); // use uri to fetch the nft metadata stored on ipfs \n\n        const response = await fetch(uri + \".json\");\n        const metadata = await response.json();\n        const identicon = `data:image/png;base64,${new Identicon(metadata.name + metadata.price, 330).toString()}`; // define item object\n\n        let item = {\n          price: i.price,\n          itemId: i.tokenId,\n          name: metadata.name,\n          audio: metadata.audio,\n          identicon,\n          resellPrice: null\n        };\n        return item;\n      } else {\n        // get uri url from contract\n        const uri = await contract.tokenURI(i.tokenId); // use uri to fetch the nft metadata stored on ipfs \n\n        const response = await fetch(uri + \".json\");\n        const metadata = await response.json();\n        const identicon = `data:image/png;base64,${new Identicon(metadata.name + 'cold' + metadata.price, 330).toString()}`; // define item object\n\n        let item = {\n          price: i.price,\n          itemId: i.tokenId,\n          name: metadata.name,\n          audio: metadata.audio,\n          identicon,\n          resellPrice: null\n        };\n        return item;\n      }\n    }));\n    setMyTokens(myTokens);\n    setLoading(false);\n  };\n\n  const resellItem = async item => {\n    if (resellPrice === \"0\" || item.itemId !== resellId || !resellPrice) return; // Get royalty fee\n\n    const fee = await contract.royaltyFee();\n    const price = ethers.utils.parseEther(resellPrice.toString());\n    await (await contract.resellToken(item.itemId, price, {\n      value: fee\n    })).wait();\n    loadMyTokens();\n  };\n\n  useEffect(() => {\n    if (isPlaying) {\n      audioRefs.current[selected].play();\n      if (selected !== previous) audioRefs.current[previous].pause();\n    } else if (isPlaying !== null) {\n      audioRefs.current[selected].pause();\n    }\n  });\n  useEffect(() => {\n    !myTokens && loadMyTokens();\n  });\n  if (loading) return /*#__PURE__*/_jsxDEV(\"main\", {\n    style: {\n      padding: \"1rem 0\"\n    },\n    children: /*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 82,\n    columnNumber: 5\n  }, this);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex justify-center\",\n    children: myTokens.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-5 container\",\n      children: /*#__PURE__*/_jsxDEV(Row, {\n        xs: 1,\n        md: 2,\n        lg: 4,\n        className: \"g-4 py-5\",\n        children: myTokens.map((item, idx) => /*#__PURE__*/_jsxDEV(Col, {\n          className: \"overflow-hidden\",\n          children: [/*#__PURE__*/_jsxDEV(\"audio\", {\n            src: item.audio,\n            ref: el => audioRefs.current[idx] = el\n          }, idx, false, {\n            fileName: _jsxFileName,\n            lineNumber: 94,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Card, {\n            children: [/*#__PURE__*/_jsxDEV(Card.Img, {\n              variant: \"top\",\n              src: item.identicon\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 96,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Card.Body, {\n              color: \"secondary\",\n              children: [/*#__PURE__*/_jsxDEV(Card.Title, {\n                children: item.name\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 98,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"d-grid px-4\",\n                children: /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"secondary\",\n                  onClick: () => {\n                    setPrevious(selected);\n                    setSelected(idx);\n                    if (!isPlaying || idx === selected) setIsPlaying(!isPlaying);\n                  },\n                  children: isPlaying && selected === idx ? /*#__PURE__*/_jsxDEV(\"svg\", {\n                    xmlns: \"http://www.w3.org/2000/svg\",\n                    width: \"23\",\n                    height: \"23\",\n                    fill: \"currentColor\",\n                    className: \"bi bi-pause\",\n                    viewBox: \"0 0 16 16\",\n                    children: /*#__PURE__*/_jsxDEV(\"path\", {\n                      d: \"M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 107,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 106,\n                    columnNumber: 27\n                  }, this) : /*#__PURE__*/_jsxDEV(\"svg\", {\n                    xmlns: \"http://www.w3.org/2000/svg\",\n                    width: \"23\",\n                    height: \"23\",\n                    fill: \"currentColor\",\n                    className: \"bi bi-play\",\n                    viewBox: \"0 0 16 16\",\n                    children: /*#__PURE__*/_jsxDEV(\"path\", {\n                      d: \"M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 111,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 110,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 100,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 99,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Card.Text, {\n                className: \"mt-1\",\n                children: [ethers.utils.formatEther(item.price), \" ETH\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 116,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 97,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(Card.Footer, {\n              children: /*#__PURE__*/_jsxDEV(InputGroup, {\n                className: \"my-1\",\n                children: [/*#__PURE__*/_jsxDEV(Button, {\n                  onClick: () => resellItem(item),\n                  variant: \"outline-primary\",\n                  id: \"button-addon1\",\n                  children: \"Resell\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 122,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Form.Control, {\n                  onChange: e => {\n                    setResellId(item.itemId);\n                    setResellPrice(e.target.value);\n                  },\n                  size: \"md\",\n                  value: resellId === item.itemId ? resellPrice : '',\n                  required: true,\n                  type: \"number\",\n                  placeholder: \"Price in ETH\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 125,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 121,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 120,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 95,\n            columnNumber: 17\n          }, this)]\n        }, idx, true, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"main\", {\n      style: {\n        padding: \"1rem 0\"\n      },\n      children: /*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"No owned tokens\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 13\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 11\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 88,\n    columnNumber: 5\n  }, this);\n}\n\n_s(MyTokens, \"CLt6c65+2VDHIgUOqqZYHsIPPhM=\");\n\n_c = MyTokens;\n\nvar _c;\n\n$RefreshReg$(_c, \"MyTokens\");","map":{"version":3,"sources":["/Users/cengwenxin/Desktop/6883project/src/frontend/components/MyTokens.js"],"names":["useState","useEffect","useRef","ethers","Identicon","Row","Col","Card","Button","InputGroup","Form","MyTokens","contract","audioRefs","isPlaying","setIsPlaying","loading","setLoading","myTokens","setMyTokens","selected","setSelected","previous","setPrevious","resellId","setResellId","resellPrice","setResellPrice","loadMyTokens","results","getMyTokens","Promise","all","map","i","tokenId","uri","tokenURI","response","fetch","metadata","json","identicon","name","price","toString","item","itemId","audio","resellItem","fee","royaltyFee","utils","parseEther","resellToken","value","wait","current","play","pause","padding","length","idx","el","formatEther","e","target"],"mappings":"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","sourcesContent":["import { useState, useEffect, useRef } from 'react'\nimport { ethers } from \"ethers\"\nimport Identicon from 'identicon.js';\nimport { Row, Col, Card, Button, InputGroup, Form } from 'react-bootstrap'\n\nexport default function MyTokens({ contract }) {\n  const audioRefs = useRef([]);\n  const [isPlaying, setIsPlaying] = useState(null)\n  const [loading, setLoading] = useState(true)\n  const [myTokens, setMyTokens] = useState(null)\n  const [selected, setSelected] = useState(0)\n  const [previous, setPrevious] = useState(null)\n  const [resellId, setResellId] = useState(null)\n  const [resellPrice, setResellPrice] = useState(null)\n  const loadMyTokens = async () => {\n    // Get all unsold items/tokens\n    const results = await contract.getMyTokens()\n    const myTokens = await Promise.all(results.map(async i => {\n      if (i.tokenId != 3){\n      // get uri url from contract\n      const uri = await contract.tokenURI(i.tokenId)\n      // use uri to fetch the nft metadata stored on ipfs \n      const response = await fetch(uri + \".json\")\n      const metadata = await response.json()\n      const identicon = `data:image/png;base64,${new Identicon(metadata.name + metadata.price, 330).toString()}`\n      // define item object\n      let item = {\n        price: i.price,\n        itemId: i.tokenId,\n        name: metadata.name,\n        audio: metadata.audio,\n        identicon,\n        resellPrice: null\n      }\n      return item\n      }\n      else{\n      // get uri url from contract\n      const uri = await contract.tokenURI(i.tokenId)\n      // use uri to fetch the nft metadata stored on ipfs \n      const response = await fetch(uri + \".json\")\n      const metadata = await response.json()\n      const identicon = `data:image/png;base64,${new Identicon(metadata.name + 'cold' +metadata.price, 330).toString()}`\n      // define item object\n      let item = {\n        price: i.price,\n        itemId: i.tokenId,\n        name: metadata.name,\n        audio: metadata.audio,\n        identicon,\n        resellPrice: null\n      }\n      return item\n      }\n      \n    }))\n    setMyTokens(myTokens)\n    setLoading(false)\n  }\n  const resellItem = async (item) => {\n    if (resellPrice === \"0\" || item.itemId !== resellId || !resellPrice) return\n    // Get royalty fee\n    const fee = await contract.royaltyFee()\n    const price = ethers.utils.parseEther(resellPrice.toString())\n    await (await contract.resellToken(item.itemId, price, { value: fee })).wait()\n    loadMyTokens()\n  }\n  useEffect(() => {\n    if (isPlaying) {\n      audioRefs.current[selected].play()\n      if (selected !== previous) audioRefs.current[previous].pause()\n    } else if (isPlaying !== null) {\n      audioRefs.current[selected].pause()\n    }\n\n  })\n  useEffect(() => {\n    !myTokens && loadMyTokens()\n  })\n\n  if (loading) return (\n    <main style={{ padding: \"1rem 0\" }}>\n      <h2>Loading...</h2>\n    </main>\n  )\n\n  return (\n    <div className=\"flex justify-center\">\n      {myTokens.length > 0 ?\n        <div className=\"px-5 container\">\n          <Row xs={1} md={2} lg={4} className=\"g-4 py-5\">\n            {myTokens.map((item, idx) => (\n              <Col key={idx} className=\"overflow-hidden\">\n                <audio src={item.audio} key={idx} ref={el => audioRefs.current[idx] = el}></audio>\n                <Card>\n                  <Card.Img variant=\"top\" src={item.identicon} />\n                  <Card.Body color=\"secondary\">\n                    <Card.Title>{item.name}</Card.Title>\n                    <div className=\"d-grid px-4\">\n                      <Button variant=\"secondary\" onClick={() => {\n                        setPrevious(selected)\n                        setSelected(idx)\n                        if (!isPlaying || idx === selected) setIsPlaying(!isPlaying)\n                      }}>\n                        {isPlaying && selected === idx ? (\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"23\" height=\"23\" fill=\"currentColor\" className=\"bi bi-pause\" viewBox=\"0 0 16 16\">\n                            <path d=\"M6 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5zm4 0a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5z\" />\n                          </svg>\n                        ) : (\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"23\" height=\"23\" fill=\"currentColor\" className=\"bi bi-play\" viewBox=\"0 0 16 16\">\n                            <path d=\"M10.804 8 5 4.633v6.734L10.804 8zm.792-.696a.802.802 0 0 1 0 1.392l-6.363 3.692C4.713 12.69 4 12.345 4 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692z\" />\n                          </svg>\n                        )}\n                      </Button>\n                    </div>\n                    <Card.Text className=\"mt-1\">\n                      {ethers.utils.formatEther(item.price)} ETH\n                    </Card.Text>\n                  </Card.Body>\n                  <Card.Footer>\n                    <InputGroup className=\"my-1\">\n                      <Button onClick={() => resellItem(item)} variant=\"outline-primary\" id=\"button-addon1\">\n                        Resell\n                      </Button>\n                      <Form.Control\n                        onChange={(e) => {\n                          setResellId(item.itemId)\n                          setResellPrice(e.target.value)\n                        }}\n                        size=\"md\"\n                        value={resellId === item.itemId ? resellPrice : ''}\n                        required type=\"number\"\n                        placeholder=\"Price in ETH\"\n                      />\n                    </InputGroup>\n                  </Card.Footer>\n                </Card>\n              </Col>\n            ))}\n          </Row>\n        </div>\n        : (\n          <main style={{ padding: \"1rem 0\" }}>\n            <h2>No owned tokens</h2>\n          </main>\n        )}\n    </div>\n  );\n}"]},"metadata":{},"sourceType":"module"}